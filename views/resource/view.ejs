<div class="page-container">
    <div id="loading" class="loading-state">
        <span class="loader">‚è≥</span>
        <p>Loading quiz...</p>
    </div>

    <div id="quizContent" style="display: none;">
        <div class="quiz-detail-header">
            <div class="quiz-detail-info">
                <h1 id="quizTitle">Quiz Title</h1>
                <p id="quizDescription" class="quiz-description"></p>
                <div class="quiz-meta-info">
                    <span class="badge" id="quizVisibility">Private</span>
                    <span id="quizQuestionCount">0 questions</span>
                    <span id="quizCreatedAt">Created: -</span>
                    <span id="quizOwner">By: -</span>
                </div>
            </div>
            <div class="quiz-detail-actions">
                <a href="#" id="playBtn" class="btn btn-primary">‚ñ∂ Play Quiz</a>
                <a href="#" id="editBtn" class="btn btn-outline">‚úèÔ∏è Edit</a>
                <button id="deleteBtn" class="btn btn-danger">üóëÔ∏è Delete</button>
            </div>
        </div>

        <div class="quiz-questions-preview">
            <h2>Questions Preview</h2>
            <div id="questionsPreview"></div>
        </div>
    </div>
</div>

<script>
    const quizId = '<%= quizId %>';

    document.addEventListener('DOMContentLoaded', async function () {
        if (!isLoggedIn()) {
            window.location.href = '/auth/login';
            return;
        }

        await loadQuiz();

        document.getElementById('deleteBtn').addEventListener('click', deleteQuiz);
    });

    async function loadQuiz() {
        try {
            const response = await fetchWithAuth(`/resource/${quizId}`);
            const data = await response.json();

            if (data.success) {
                const quiz = data.data.resource;

                document.getElementById('quizTitle').textContent = quiz.title;
                document.getElementById('quizDescription').textContent = quiz.description || 'No description';
                document.getElementById('quizVisibility').textContent = quiz.isPublic ? 'üåê Public' : 'üîí Private';
                document.getElementById('quizVisibility').className = `badge ${quiz.isPublic ? 'badge-success' : 'badge-warning'}`;
                document.getElementById('quizQuestionCount').textContent = `${quiz.questions.length} questions`;
                document.getElementById('quizCreatedAt').textContent = `Created: ${new Date(quiz.createdAt).toLocaleDateString()}`;
                document.getElementById('quizOwner').textContent = `By: ${quiz.owner?.username || 'Unknown'}`;

                document.getElementById('playBtn').href = `/play/${quizId}`;
                document.getElementById('editBtn').href = `/quizzes/edit/${quizId}`;

                // Render questions preview
                const questionsHtml = quiz.questions.map((q, idx) => `
        <div class="question-preview-card">
          <div class="question-number">Q${idx + 1}</div>
          <div class="question-content">
            <p class="question-text">${escapeHtml(q.text)}</p>
            <ul class="options-list">
              ${q.options.map((opt, optIdx) => `
                <li class="${optIdx === q.correctIndex ? 'correct' : ''}">
                  ${optIdx === q.correctIndex ? '‚úì' : '‚óã'} ${escapeHtml(opt)}
                </li>
              `).join('')}
            </ul>
          </div>
        </div>
      `).join('');

                document.getElementById('questionsPreview').innerHTML = questionsHtml;

                document.getElementById('loading').style.display = 'none';
                document.getElementById('quizContent').style.display = 'block';
            } else {
                showToast(data.error || 'Failed to load quiz', 'error');
                setTimeout(() => window.location.href = '/quizzes', 2000);
            }
        } catch (error) {
            showToast('Network error', 'error');
        }
    }

    async function deleteQuiz() {
        if (!confirm('Are you sure you want to delete this quiz?')) return;

        try {
            const response = await fetchWithAuth(`/resource/${quizId}`, {
                method: 'DELETE'
            });

            const data = await response.json();

            if (data.success) {
                showToast('Quiz deleted successfully', 'success');
                setTimeout(() => window.location.href = '/quizzes', 1000);
            } else {
                showToast(data.error || 'Failed to delete quiz', 'error');
            }
        } catch (error) {
            showToast('Network error', 'error');
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>